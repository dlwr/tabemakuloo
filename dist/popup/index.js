var l=Object.defineProperty;var p=(r,t,e)=>t in r?l(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var i=(r,t,e)=>p(r,typeof t!="symbol"?t+"":t,e);import"../chunks/modulepreload-polyfill.B5Qt9EMX.js";import{b as n}from"../chunks/browser-polyfill.DX5UB71L.js";class d{constructor(){i(this,"titleInput");i(this,"descriptionTextarea");i(this,"tagsInput");i(this,"postButton");this.titleInput=document.querySelector("#title"),this.descriptionTextarea=document.querySelector("#description"),this.tagsInput=document.querySelector("#tags"),this.postButton=document.querySelector("#postBtn"),this.init()}async init(){await this.loadCurrentPageData(),this.setupEventListeners()}async loadCurrentPageData(){try{const e=(await n.tabs.query({active:!0,currentWindow:!0}))[0];if(e!=null&&e.id){const s=await n.tabs.sendMessage(e.id,{type:"GET_PAGE_DATA"});s&&this.populateForm(s)}}catch(t){console.error("Failed to load page data:",t);const s=(await n.tabs.query({active:!0,currentWindow:!0}))[0];s&&(this.titleInput.value=s.title??"")}}populateForm(t){this.titleInput.value=t.title??"",this.descriptionTextarea.value=t.description??""}setupEventListeners(){this.postButton.addEventListener("click",this.handlePost.bind(this))}async handlePost(){var t;this.postButton.disabled=!0,this.postButton.textContent="投稿中...";try{const e=await this.collectFormData(),s=this.getSelectedServices();console.log("Posting to services:",s,e);const o=await n.runtime.sendMessage({type:"POST_TO_SERVICES",data:{postData:e,services:s}});if(o!=null&&o.results){const a=o.results.filter(c=>c.success).length,u=o.results.length;if(a===u)this.postButton.textContent="投稿完了！",setTimeout(()=>{window.close()},1e3);else if(a>0)this.postButton.textContent=`一部成功 (${a}/${u})`,setTimeout(()=>{this.resetPostButton()},3e3);else{const c=((t=o.results[0])==null?void 0:t.error)??"Unknown error";this.postButton.textContent=`投稿失敗: ${c}`,setTimeout(()=>{this.resetPostButton()},3e3)}}else throw new Error("Invalid response from background script")}catch(e){console.error("Post failed:",e),this.postButton.textContent="投稿失敗",setTimeout(()=>{this.resetPostButton()},2e3)}}resetPostButton(){this.postButton.disabled=!1,this.postButton.textContent="投稿する"}async collectFormData(){var s;const e=((s=(await n.tabs.query({active:!0,currentWindow:!0}))[0])==null?void 0:s.url)??"";return{title:this.titleInput.value,url:e,description:this.descriptionTextarea.value,tags:this.tagsInput.value.split(",").map(o=>o.trim()).filter(Boolean)}}getSelectedServices(){const t=document.querySelectorAll('.services input[type="checkbox"]:checked');return Array.from(t).map(e=>e.id)}}new d;
//# sourceMappingURL=index.js.map
